{"version":3,"sources":["../../src/db/db.js"],"names":["_lf","require","path","currentFileDetermination","Directory","DirFunctions","A","DIR_OPEN","DIR_CLOSED","FILE_OPEN","_SCHEMA","name","children","working","isExpanded","sourceCode","isSaved","fileType","isdir","openFiles","SUPPORTED_TYPES","mode","prevAction","project","type","dependencies","_dbKeys","Fonst","getValue","key","getItem","_filepath","p","split","_setItem","k","v","then","current","setItem","setValue","value","Array","isArray","Promise","all","map","el","setValues","values","initDb","config","driver","INDEXEDDB","storeName","_save","directory","_edit","_toggle","_open","open","_close","_resetDB","dbKeys","e","console","error","keys","_getDb","db","log","deleteDB","curFileFormat","filename","filepath","extname","getDB","applicationState","database","Object","updateProjectOpenFiles","updatedOpenFiles","currentFile","newDirectory","project_type","mappingDir","to_dir","dirname","length","currentDirectory","filter","t","join","numOfChildren","updatedValues","concat","updateProjectDependencies","mutateCurrentDir","_mutate","updatedDirectory","toggleFolder","folderpath","paths","changeDir","closeFile","oparray","isCurrent","dir","updatedFile","file","newNode","nodename","nodepath","nodetype","_newNode","lang","newlyCreated","_change","mutateOpenFiles","actions","openFile","prevOpenFilePath","parts","openFilesActions","push","object","prevpath","prevfilename","obj","f","saveFile","editFile","updatedFiles","closeCurrentDirectory","currentValues","window","AppState","module","exports"],"mappings":"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","sourcesContent":["const _lf = require(\"localforage\");\nconst path = require(\"path\");\nconst { currentFileDetermination } = require(\".\");\nconst Directory = require(\"./directory\");\n\nconst DirFunctions = new Directory();\n\nconst A = { \n    DIR_OPEN:\"DIRECTORY-OPEN\",\n    DIR_CLOSED:\"DIRECTORY-CLOSED\",\n    FILE_OPEN:\"FILE-OPEN\"\n}\n\nconst _SCHEMA = {\n    \"appState\":null,\n    \"currentDirectory\":{\n        name:\"\",\n        children:null,\n        working:false,\n        isExpanded:false,\n        path:\"\"\n    },\n    \"currentFile\":{\n        name:\"\",\n        sourceCode:\"\",\n        isSaved:false,\n        fileType:\"\",\n        isdir:false,\n        path:''\n    },\n    openFiles:{},\n    SUPPORTED_TYPES:{ \".js\":\"javascript\",\".html\":\"html\",\".css\":\"css\",\".json\":\"json\" },\n    mode:\"dark\",\n    prevAction:\"\",\n    project:{\n        type:'',\n        path:'',\n        dependencies:[]\n    }\n}\n\nconst _dbKeys = [ \"appState\",\"currentDirectory\",\"currentFile\",\"SUPPORTED_TYPES\",\"mode\",\"openFiles\",\"prevAction\",\"project\"];\n\n\n\nconst Fonst = {\n    getValue( key ) { return _lf.getItem(key); },\n\n    _filepath(p) { return p.split('/');  },\n\n\t_setItem(k,v) {\n\t\tif ( typeof v == \"function\" ) {\n\t\t\treturn this.getValue(k).then(current => _lf.setItem(k,v(current)) )\n\t\t}\n\t\treturn _lf.setItem(k,v); \n\t},\n\n\t/** set value of a key in database.\n\t * @param string key -> database key which is being mutated.\n\t * @param string | function value -> either the updated value or the the function which mutates the value o\n\t * of the key.\n\t * @returns Promise<{}> object which resolves when key is updated to new value.\n\t */\n\tsetValue( key,value ) { \n\t\tif ( !Array.isArray(key) ) { key = [key] }\n\n\t\t//return promise that resolves when all the updated values have been set.\n\t\treturn Promise.all( key.map(el => this._setItem(el,value)) )\n\t},\n\n\n\t/**set multiple values of the multiple keys in the database.\n\t* @param array values -> array of objects containing key value fields \n\t* @returns Promise<{}> object -> resolves when all values and keys have been set.\n\t*/\n\tsetValues(values) {\n        //console.log(\" setting values \",values);\n\t\treturn Promise.all(values.map(({key,value}) => this._setItem(key,value)))\n\t},\n\t\n\n\t/** initialize localforage database with user data. only set when user initially registers.\n\t * @returns void\n\t */\n\tasync initDb() {\n\t\t_lf.config({\n\t\t\tdriver:_lf.INDEXEDDB,\n\t\t\tname:`planck-ide-data`,\n\t\t\tstoreName:\"planck-data\",\n\t\t})\n\t},\n\t\n\n    // helper functions for changeDir function.\n\n    //save function.\n    _save(directory)   {  return { ...directory,isSaved:true }; },\n    //edit function.\n    _edit(directory)   { return { ...directory,isSaved:false }; },\n    //toggle function.\n    _toggle(directory) { return { ...directory,isExpanded:!directory.isExpanded } },\n    //open function.\n    _open(directory)   { return { ...directory,open:true } },\n    //close function.\n    _close(directory)  { return { ...directory,open:false } },\n\n\tasync _resetDB() \n    {\n\t\tfor ( let key of dbKeys ) {\n\t\t\ttry {\n\t\t\t\tawait this.setValue(key,null);\n\t\t\t}\n\t\t\tcatch(e) { console.error(e); }\n\t\t}\n\t},\n\n\t//obtain database keys.\n\tkeys()  { return _lf.keys() },\n\n    /**obtain database values if database exists. */\n    async _getDb() \n    {\n        let db = {};\n        for (let key of _dbKeys) {\n            try {\n                db[key] = (await this.getValue(key)) || _SCHEMA[key];\n            }\n            catch(e) {\n                console.log(\" error occured \");\n                throw e;\n            }\n        }\n        return db;\n    },\n\n    async deleteDB() {\n        for (let key of _dbKeys) {\n            await this.setValue(key,_SCHEMA[key]);\n        }\n    },\n\n    //returns current file database format.\n    curFileFormat({filename,sourceCode,filepath}) \n    {\n        return {\n            name:filename,\n            sourceCode,\n            isSaved:true,\n            fileType:_SCHEMA.SUPPORTED_TYPES[path.extname(filepath)],\n            path:filepath\n        }\n    },\n\n\n    /** application startup retrieve database.if that operation throws database\n     * (we conclude database hasn't been created) then we initialise database  \n     * then return default database values. else we return current database provided.\n    */\n    async getDB() \n    {\n        let applicationState = {};\n        try {\n            //console.log(' obtaining db ');\n            return await this._getDb();\n        }\n        catch(e) {\n            //in the event that database has not been initialized.\n            //initialize database.\n            await this.initDb();\n            let database = Object.keys(_SCHEMA).map(key => { return { key,value:_SCHEMA[key] } });\n\n            //set default values of database.\n            await this.setValues(database);\n            applicationState = _SCHEMA;\n        }\n        //return application state\n        return applicationState;\n    },\n\n    /** determine whether the project's currently open files have been changed.\n     * if they have then update the openFiles attribute to contain these newly contained\n     * open files.\n     * parameters passed:\n     * @param updatedOpenFiles --> object containing updated source code of the currently opened files.\n     * @returns void.\n      */\n    async updateProjectOpenFiles({ updatedOpenFiles }) \n    {\n        let openFiles = {};\n        let currentFile = {};\n        try {\n            openFiles = await this.getValue('openFiles');\n            currentFile = await this.getValue(\"currentFile\");\n        }\n        catch(e) {}\n        for ( let filename of Object.keys(openFiles) ) {\n            console.log(\" updated open files \",updatedOpenFiles[filename]);\n            if (currentFile && currentFile.path == updatedOpenFiles[filename].path) {\n                currentFile.sourceCode = updatedOpenFiles[filename].sourceCode;\n            }\n            openFiles[filename] = {\n                ...openFiles[filename],sourceCode:updatedOpenFiles[filename].sourceCode\n            }\n        }\n        //set openFiles object.\n        try {\n            await this.setValue('currentFile',currentFile);\n        }\n        catch(e) { console.log(\" unable to update currentFile object \",e); }\n\n        return await this.setValue('openFiles',openFiles);\n    },\n\n    /** functionality which obtains and maps a new directory.\n     * @param children       object containing children of new directory.\n     * @param filepath       path to the current directory. \n     * @param project_type   languages type being used in the directory source code\n     * @param mappingDir     boolean value of whether or not this is simply updating directory\n    */\n    async newDirectory(filepath,children,project_type,mappingDir=false) \n    {\n        let to_dir = filepath.split('/');\n        let dirname = to_dir[to_dir.length-1];\n        let currentDirectory = {\n            name:dirname,\n            path:to_dir.filter(t => t != dirname).join('/'),\n            currentFile:null,\n            children,\n            numOfChildren:Object.keys(children).length,\n            isExpanded:true,\n            isdir:true\n        }\n        let openFiles;\n        try {\n            openFiles = await this.getValue('openFiles');\n        }\n        catch(e) { console.log(\" unable to obtain mapped open files, \",e) }\n        console.log(\" mapped children \",children);\n        let updatedValues = [\n            { key:'currentDirectory',value:currentDirectory},\n            { key:'project',value:{ type:project_type,path:filepath,dependencies:[] } }\n        ];\n        updatedValues = mappingDir ? updatedValues:updatedValues.concat({ key:\"appState\",value:A.DIR_OPEN });\n\n        //set provided  values for updated directory.\n        return this.setValues(updatedValues);\n    },\n\n    //update the project dependencies.\n    async updateProjectDependencies(dependencies)\n    {\n        let project;\n        try {\n            project = await this.getValue('project');\n        }\n        catch(e) {}\n\n        return this.setValue('project',{ ...project,dependencies });\n    },\n\n    /**functionality that takes in a function as an argument that is\n     * @param {_mutate}  -> function provided by user that changes directory in the way user wishes it to change.\n     * @returns Promise<Object> containing the updated directory or null.\n     */\n    async mutateCurrentDir({ _mutate }) \n    {\n        let currentDirectory = {};\n        try {\n            currentDirectory = await this.getValue(\"currentDirectory\");\n        }\n        catch(e) {\n            console.log(e);\n        }\n        //obtain updated value of the directory.\n        let updatedDirectory = _mutate(currentDirectory);\n        //if updatedDirectory is valid then update value of currentDirectory key.\n        return updatedDirectory ? this.setValue(\"currentDirectory\",updatedDirectory) : null;\n    },\n\n    /**\n     * gui functionality responsible for enabling graphical opening of folders in file directory\n     * through the change of state.\n     * \n     */\n    async toggleFolder(folderpath) \n    {\n        let paths = folderpath.split('/');\n        let currentDirectory = {};\n        try {\n            currentDirectory = await this.getValue('currentDirectory');\n        }\n        catch(e) {}\n        //make appropriate manipulations to the current directory.\n        console.log(\" toggle here  problem\");\n        currentDirectory = DirFunctions.changeDir(currentDirectory,paths,this._toggle);\n\n        return await this.setValue(\"currentDirectory\",currentDirectory);\n    },\n\n    //closeFile functionality closes file given by the current data.\n    //filename -> string value of the file being closed.\n    //filepath -> string value of the path to the file being closed.\n    //isCurrent -> boolean value of whether the file is the current file being displayed.\n    async closeFile({ filename }) \n    {\n        let openFiles = {};\n        try \n        {\n            openFiles = await this.getValue(\"openFiles\");\n        }\n        catch(e) {};\n        let updatedValues = [];\n        let oparray = Object.keys(openFiles);\n        let currentFile = {};\n        //console.log(' open files ',openFiles);\n        if (openFiles[filename].isCurrent) {\n            //then currentFile must be updated obtain the first file open and set that as \n            //the new currentFile.\n            //if openFile is the only open file we change state to directory.\n            switch(oparray.length) \n            {\n                case 1:\n                    //in this case we reset ui to directory display mode.\n                    let _mutate = dir => { return { ...dir,currentFile:null }; }\n                    try \n                    {\n                        //mutate current directory.\n                        await this.mutateCurrentDir({ _mutate })\n                    }\n                    catch(e) {}\n                    openFiles = {};\n                    //updated application state\n                    updatedValues = updatedValues.concat({ key:\"appState\",value:A.DIR_OPEN })\n                    break;\n\n                default:\n                    //if there is more than 1 file then we find new current file and\n                    //update values in db.\n                    let updatedFile = \"\";\n                    for (let file of oparray ) {\n                        //console.log(' filename ',file);\n                        if (file != filename) {  updatedFile = file;break; }\n                    }\n                    //delete closed file.\n                    delete openFiles[filename];\n                    //update value of new currentFile.\n                    //new current file values.\n                    currentFile = openFiles[updatedFile];\n                    //console.log(' new current file ',currentFile);\n                    updatedValues = updatedValues.concat({key:'currentFile',value:currentFile});\n                    openFiles[updatedFile] = { ...currentFile,isCurrent:true };\n                    break;\n            }\n        }\n        else /*if file is not current then we delet file.*/delete openFiles[filename];\n        //update keys.\n        try  {\n            await this.setValues(\n                [ { key:\"openFiles\",value:openFiles }].concat(updatedValues)\n            )\n        }\n        catch(e) {}\n        return currentFile;\n    },\n\n    async newNode({ nodename,nodepath,nodetype })\n    {\n        //add the new file to the current directory.\n        console.log(\" file path of new node \",nodepath,\" nam of new node \",nodename);\n        let currentDirectory = {};\n        let _newNode = {};\n        if (nodetype == 'file') {\n            let fileType  = path.extname(nodename),lang;\n            try {\n                lang = (await this.getValue('SUPPORTED_TYPES'))[fileType]\n            }\n            catch(e) {}\n            _newNode = {\n                path:nodepath,\n                isdir:false,\n                sourceCode:'',\n                fileType:lang,\n                open:false,\n                newlyCreated:true\n            }\n        }\n        else {\n            _newNode = {\n                name:nodename,\n                path:nodepath,\n                currentFile:null,\n                children:{},\n                numOfChildren:0,\n                isExpanded:false,\n                isdir:true\n            }       \n        }\n        console.log(\" node path \",nodepath);\n        let _change = (directory) => \n            {  \n                let children = directory.children;\n                children[nodename] = _newNode;\n                return { ...directory,children }  \n            }\n        try {\n            //obtain the value of the current directory.\n            currentDirectory = await this.getValue('currentDirectory');\n            //change directory add new file to directory whose path matches that given\n            currentDirectory = await DirFunctions.changeDir(currentDirectory,nodepath.split('/'),_change);\n            //console.log(\" updated directory with new node \",currentDirectory);\n            return this.setValue('currentDirectory',currentDirectory);\n        }\n        catch(e) { /* unable to mutate current directory. */console.log(' error has occured ',e); }\n    },\n\n    //does mutations to the 'openFiles' object in the database\n    //'actions' array contains key ,value pairs of filenames and updated values.\n    async mutateOpenFiles({ actions }) \n    {\n        let openFiles = {};\n        try {\n            openFiles = await this.getValue(\"openFiles\");\n        }\n        catch(e) { console.log(\" error obtained in mutateOpenFiles function \",e); }\n        //complete actions on openFiles object.\n        actions.map( ({ key,value }) => \n        {     \n            if (typeof value == \"function\") \n            {\n                //console.log(\" function found \",value);\n                openFiles[key] = value(openFiles);\n            }\n            else openFiles[key] = value; \n        })        \n        return this.setValue('openFiles',openFiles);\n    },\n\n    /**functionality responsible for opening and set a file as the current file being edited in the text editor\n    filepath -> string type path to source file \n    sourceCode -> string value which copy of the file's contents\n    isInDirectory -> boolean value referring to whether or not file is in current project directory open.\n    prevOpenFile -> string value. whether or not there was a file previously open*/\n    async openFile({ filepath,sourceCode,prevOpenFilePath,newlyCreated }) \n    {\n        let parts = filepath.split('/');\n        let openFilesActions = [];\n        //obtain the current filename for the directory.\n        let filename = parts[parts.length-1];\n        let currentFile = this.curFileFormat({ filename,sourceCode,filepath });\n        //set file in the list of currently open file.\n        console.log(' opening  ',filename);\n        openFilesActions.push(\n            { \n                key:filename,\n                value:(object) => {\n                    if (object[filename]) {\n                        currentFile.isSaved = object[filename].isSaved;\n                        return { ...object[filename],isCurrent:true }\n                    }\n                    return ({ ...currentFile,isCurrent:true })\n                }\n        });\n        //list of updated values which will be set in the database.\n        //if file has been previously opened.\n        if (prevOpenFilePath) {\n            console.log(' previously opened file present ');\n            let prevpath = prevOpenFilePath.split('/');\n            let prevfilename = prevpath[prevpath.length-1];\n            openFilesActions.push(\n                { \n                    key:prevfilename,\n                    value:obj => ({ ...obj[prevfilename],isCurrent:false })\n                });    \n        }\n        //update openFile object.\n        try {\n            if (newlyCreated) {\n                let currentDirectory = await this.getValue('currentDirectory');\n                function _change(directory) {\n                    let children = directory.children;\n                    children[filename] = { ...children[filename],newlyCreated:false }\n                    return { ...directory,children }\n                }\n                currentDirectory = DirFunctions.changeDir(currentDirectory,parts.filter(f => f != filename),_change);\n\n                //set current directory value to false.\n                await this.setValue('currentDirectory',currentDirectory);\n            }\n            //update previously opened file in currentDirectory\n            await this.mutateOpenFiles({ actions:openFilesActions });\n            //console.log(\" updated all  openFiles\");\n        }\n        catch(e) { console.log(\" error obtained \",e); }\n        //set values in database.\n        return await this.setValues([\n            { key:\"currentFile\",value:currentFile },\n            { key:\"appState\",value:A.FILE_OPEN },\n            { key:\"prevAction\",value:\"open\" },\n        ]);\n    },\n    \n    //functionality used to save the current file.\n    async saveFile() \n    {\n        let currentFile = {};\n        try \n        {\n            currentFile      = await this.getValue(\"currentFile\");\n        }\n        catch(e) {}\n        let filename = currentFile.name;\n        try \n        {//update openFiles value.\n            await this.mutateOpenFiles({ \n                actions:[ { \n                    key:filename,\n                    value:obj =>  { \n                        return { ...obj[filename],isSaved:true,sourceCode:currentFile.sourceCode }  \n                    }\n                }] \n            })\n        }\n        catch(e) {}\n        //set values of currentDirectory,currentFile and openFiles.\n        return await this.setValues([\n            { key:\"currentFile\",value:{ ...currentFile,isSaved:true } },\n            { key:\"prevAction\",value:\"save\" }\n        ]);\n    },\n\n    //case where file is being edited and therefore must be updated as not saved.\n    async editFile(sourceCode) {\n        let currentFile = await this.getValue(\"currentFile\");\n        let updatedFiles = [ \n            { key:\"currentFile\",value:{ ...currentFile,isSaved:false,sourceCode } },\n            { key:\"prevAction\",value:\"edit\" }\n        ]\n        //if the current file is currently said to be saved then we manipulate that.\n        //if (currentFile.isSaved) {\n        this.mutateOpenFiles({\n            actions:[ \n                { \n                    key:currentFile.name,\n                    value:obj => { return { ...obj[currentFile.name],isSaved:false,sourceCode } } \n                }]\n        })\n        //return updated values.\n        return await this.setValues(updatedFiles);\n    },\n\n    async closeCurrentDirectory() {\n        let currentValues = [\n            { key:\"currentDirectory\",value:_SCHEMA.currentDirectory },\n            { key:\"appState\",value:null },\n            { key:\"currentFile\",value:_SCHEMA.currentFile }\n        ];\n        //set db values.\n        return await this.setValues(currentValues);\n    }\n}\n\nwindow.AppState = Fonst;\nmodule.exports =  Fonst;"],"file":"db.js"}