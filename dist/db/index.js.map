{"version":3,"sources":["../../src/db/index.js"],"names":["db","require","session","SysDirectory","_self","$this","module","exports","onApplicationStart","getApplicationState","then","currentFileDetermination","mode","currentFile","getValue","e","setSessionState","key","value","path","trim","sourceCode","_initState","$self","getDB","updateProjectDependencies","dep","getDBValues","getOpenFilesData","openFiles","updatedOpenedFiles","console","log","Promise","all","Object","keys","map","file","filepath","readFromFile","updateProjectOpenFiles","updatedOpenFiles","getDependencies","dependencies","values","forEach","updateGUIState","stateChange","promise","database","error","updateState","openDirectory","directory_path","dir_type","map_dir","dir","newDirectory","fetchFile","functionality","saveFile","newNodeCreationPrompt","nodepath","type","openFile","prevOpenFilePath","newlyCreated","toggleFolder","folderpath","closeFile","filename","closeDirectory","closeCurrentDirectory","editFile","isRunning","currentSourceCode","openProject","directoryPath","projectType","cancelNodeCreation","createNode","nodename","newNode","nodetype"],"mappings":"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","sourcesContent":["const db = require(\"./db\");\nconst session = require(\"./sessionState\");\nconst SysDirectory = require(\"../directory\");\n\nlet _self;\nlet $this;\nmodule.exports = {\n    //on the start of the application.\n    session,\n    async onApplicationStart() { \n        return this.getApplicationState().then(db => \n            {\n                this.currentFileDetermination();\n                return db.mode;\n            });\n    },\n    async currentFileDetermination() \n    {\n        let currentFile ;\n        try {\n            currentFile = await db.getValue('currentFile');\n        }\n        catch(e) {}\n        if (currentFile) {\n            this.setSessionState([ \n                { \n                    key:\"currentSourceCode\",\n                    value:{ path:currentFile.path.trim(),sourceCode:currentFile.sourceCode } \n                } \n            ]);\n        }\n    },\n\n    /**\n     * @param{$self} React Application Component instance state.\n     * _initApplicationState -- > initializes the application state.\n    * enable application state to implement ui updates using the \n    * application's react ui component state.\n    */\n    async _initState($self) { \n        _self = $self;$this = this; \n        \n    },\n\n    //function returns the last working directory\n    async getApplicationState() { return await db.getDB(); },\n\n    //set project dependencies of the project.\n    async updateProjectDependencies(dep) { \n        this.setSessionState([ { key:\"dependencies\",value:dep } ])\n        return await db.updateProjectDependencies(dep) \n    },\n\n    //functionality to obtain db values.\n    async getDBValues(value) \n    {\n        return await db.getValue(value);\n    },\n\n    //read open files source code.\n    async getOpenFilesData()\n    {\n        let openFiles = {},updatedOpenedFiles = {};\n        try {\n            openFiles = await this.getDBValues('openFiles');\n        }\n        catch(e)  {\n            console.log(\" error occured while getting open files \",e);\n        }\n        await Promise.all(\n            Object.keys(openFiles).map(async file => {\n                let filepath = openFiles[file].path;\n                let sourceCode;\n                try {\n                    sourceCode = await SysDirectory.readFromFile(filepath);\n                }\n                catch(e) {};\n                updatedOpenedFiles[file] = {  ...openFiles[file],sourceCode };\n            })\n        );\n        return db.updateProjectOpenFiles({ updatedOpenFiles:updatedOpenedFiles });\n    },\n\n    getDependencies() { return this.session.dependencies;  },\n\n    async setSessionState(values) \n    { \n        values.forEach(({key,value}) => { this.session[key] = value; })\n        return true;\n    },\n    async updateGUIState(values) { return this.stateChange(this.setSessionState(values)) },\n\n    /** @param{promise} function<Promise{}> promise argument is a function which returns a promise as its\n     * return value -> once the promise resolves ui is updated.\n    */\n    stateChange(promise) \n    { \n        return promise.then(async () => {\n            let database;\n            try {\n                database = await this.getApplicationState();\n            }\n            catch(e) { console.error(e);  }\n            //update React component ui state.\n            return _self.updateState( { ...this.session,...database }  )\n        })\n    },\n\n    //functionality which opens up a directory and returns all nodes of directory tree.\n    async openDirectory(directory_path,dir_type,map_dir) {\n        let dir = {}\n        try {\n            dir = await SysDirectory.openDirectory(directory_path);\n        }\n        catch(e) {\n            console.log(`directory unable to be loaded ${e}`);\n            return;\n        }       \n        console.log( \" mapping directory \",map_dir,\" dir \",dir);\n        return this.stateChange(db.newDirectory(directory_path,dir,dir_type,map_dir));\n    },\n\n    //functionality for fetching the current file being worked on.\n    async fetchFile() {\n        //save database file.\n        this.functionality.saveFile();\n        //return file currently being worked on.\n        return await db.getValue('currentFile');\n    },\n\n    //inform ui state of creation of a new file.\n    async newNodeCreationPrompt(nodepath,type) {\n        console.log(' creating node in filepath ',nodepath);\n        return this.stateChange(\n            this.setSessionState([\n                 { key:\"newNodeCreation\",value:true },{ key:'newNode',value:{ nodepath,type } } \n            ])\n        );\n    },\n    functionality:{\n        //functionality which opens a specific file.\n        //functionality calls database file to perform read  operation of file source.\n        async openFile({ filepath,sourceCode,prevOpenFilePath,newlyCreated }) \n        {\n            console.log(' file path ',filepath);\n            $this.setSessionState([\n                { key:\"currentSourceCode\",value:{ path:filepath,sourceCode } }\n            ]);\n            return await $this.stateChange(\n                db.openFile({ filepath,sourceCode,prevOpenFilePath,newlyCreated })\n            );\n        },\n\n        //functionality that enables the expanding of a folder's contents and hiding them aswell.\n        async toggleFolder(folderpath) \n        {\n            return await $this.stateChange( db.toggleFolder(folderpath) );\n        },\n\n        //close file closes the file pasts as an argument.\n        async closeFile(filename) \n        {\n            let currentFile;\n            try {\n                currentFile = await db.closeFile({ filename });\n            }\n            catch(e) {}\n            //set value of current source code.\n            return $this.stateChange(\n                $this.setSessionState([\n                     { \n                         key:\"currentSourceCode\",\n                         value:{ sourceCode:currentFile.sourceCode || '',path:currentFile.path } } \n                ])\n            );\n        \n        },\n\n        //closeDirectory functionality closes the directory.\n        async closeDirectory() \n        {\n            //closed directory.\n            SysDirectory.closeDirectory();\n            return await $this.stateChange( db.closeCurrentDirectory() );\n        },\n        //functionality for when the current file is being edited.\n        async editFile({sourceCode,isRunning})  \n        { \n            //console.log(' current source code ',$this.session.currentSourceCode);\n            if (isRunning)\n                $this.setSessionState([ \n                    { \n                        key:'currentSourceCode',\n                        value:{ ...$this.session.currentSourceCode,sourceCode:sourceCode } \n                    } \n                ]);\n            return await $this.stateChange(db.editFile(sourceCode)); \n        },\n\n        //functionality for saving the current file being focused on.\n        async saveFile() { return await $this.stateChange(db.saveFile()); },\n\n        async openProject({ directoryPath,projectType }) {\n            //simply return sysdirectory open directory function with a html project type.\n            return $this.openDirectory(directoryPath,projectType)\n        },\n         //cancel process of creating a new file.\n        async cancelNodeCreation() {\n            return $this.stateChange(\n                $this.setSessionState([\n                    { key:\"newNodeCreation\",value:false },{ key:\"newNode\",value:null }\n                ])\n            );\n        },\n\n        //create file functionality.\n        async createNode(nodename) {\n            let { nodepath,type } = $this.session.newNode;\n            $this.setSessionState([ \n                { key:\"newNodeCreation\",value:false },{ key:\"newNode\",value:null } \n            ]);\n            return $this.stateChange( db.newNode({ nodename,nodepath,nodetype:type }) );\n        },  \n    }\n}"],"file":"index.js"}